.. index:: CrafterCMS 4.0.3 Release Notes

----------------
CrafterCMS 4.0.3
----------------

*Released March 24, 2023*

This release includes fixes for issues with the release version 4.0.2

^^^^^^^^^^^^
New Features
^^^^^^^^^^^^

* Crafter Studio now uses `zxcvbn <https://github.com/dropbox/zxcvbn>`__ for password strength management |br|
  See `here <https://github.com/craftercms/craftercms/issues/5816>`__ for more information

  For more information on configuring the password requirements, see :ref:`crafter-studio-configure-password-requirements`

* Added support for adding headers to responses when there are matched configuration patterns in
  the Engine Project Configuration file |br|

  Crafter Engine now supports configuring ``Cache-Control`` headers via the :ref:`engine-project-configuration` file,
  using the ``headerMappings`` property.  By default, it will follow the cache policies configured, where before, it
  was set to ``no-cache``.

  If you're using a reverse-proxy or a CDN, no changes are required since caching is done by the reverse-proxy/CDN.

  See :ref:`engine-project-configuration` for more information on configuring response headers

  See `here <https://github.com/craftercms/craftercms/issues/5909>`__ for more information

* Added support for displaying item paths in Crafter Studio's PreviewDialog |br|
  See `here <https://github.com/craftercms/craftercms/issues/5954>`__ for more information

* Added support for capturing output of the ``crafter.sh`` script in a log file |br|
  See `here <https://github.com/craftercms/craftercms/issues/5887>`__ for more information

  To learn how to capture the output of the ``crafter.sh`` script, see :ref:`here <crafter-sh-script-logging>`




^^^^^^^
Updates
^^^^^^^

* Updated Studio and Engine SAML to use the new Spring Security |br|
  See :ref:`engine-saml2-configuration` and :ref:`crafter-studio-configure-studio-saml` for more information.

* The property ``studio.cache.assets.maxAge`` in the Studio configuration file is changed from minutes to seconds |br|

  .. code-block:: yaml

     ##################################################
     ##                    Cache                     ##
     ##################################################
     ...
     # The max age in seconds that the browser should cache responses for requests matching `studio.cache.assets.maxAge.includeUrls`
     studio.cache.assets.maxAge: 3600
     # The urls that should include max-age=<studio.cache.assets.maxAge> in Cache-Control header. Other urls will be set to default max-age=0, must-revalidate
     studio.cache.assets.maxAge.includeUrls: /static-assets/**,/1/plugin/file/**
     ...

* Added support for previewing PDF assets in Studio  |br|
  See `here <https://github.com/craftercms/craftercms/issues/5735>`__ for more information

* Updated Group management dashboard to sort groups alphabetically |br|
  See `here <https://github.com/craftercms/craftercms/issues/5742>`__ for more information

* Updated Moment Timezone library  |br|
  See `here <https://github.com/craftercms/craftercms/issues/5855>`__ for more information

* Added support for sorting assets by Name/Recently uploaded  |br|
  See `here <https://github.com/craftercms/craftercms/issues/5879>`__ for more information

* Fixed issue with image cropper for existing images |br|
  See `here <https://github.com/craftercms/craftercms/issues/5889>`__ for more information+

* Fixed issue with session inactivity timeout |br|
  See `here <https://github.com/craftercms/craftercms/issues/5891>`__ for more information

  For more information on session timeouts, see :ref:`changing-session-timeout`

* Improved logging for script not found errors |br|
  See `here <https://github.com/craftercms/craftercms/issues/5904>`__ for more information

* Fixed issue with Sidebar not loading properly due to a broken/missing content type |br|
  See `here <https://github.com/craftercms/craftercms/issues/5873>`__ for more information

* Fixed issue with log console errors |br|
  See `here <https://github.com/craftercms/craftercms/issues/5779>`__ for more information

* Added support for viewing and editing Sass files  |br|
  See `here <https://github.com/craftercms/craftercms/issues/5865>`__ for more information

* Improved Dashboard performance |br|
  See `here <https://github.com/craftercms/craftercms/issues/5813>`__ for more information

* Fixed typo in Dashboard publishing message |br|
  See `here <https://github.com/craftercms/craftercms/issues/5922>`__ for more information

* Fixed issue with Component and Shared Content node selectors |br|
  See `here <https://github.com/craftercms/craftercms/issues/5862>`__ for more information

* Fixed issue with decryption of data containing new lines |br|
  See `here <https://github.com/craftercms/craftercms/issues/5849>`__ for more information

* Fixed issue with assigning users to groups |br|
  See `here <https://github.com/craftercms/craftercms/issues/5836>`__ for more information

* Fixed issue with selecting items via search in item selector |br|
  See `here <https://github.com/craftercms/craftercms/issues/5903>`__ for more information

* Improved Group/User forms |br|
  See `here <https://github.com/craftercms/craftercms/issues/5897>`__ for more information

* Fixed issue with groups when using LDAP authentication |br|

* Fixed issue while performing cache warming |br|

* Upgraded the following dependencies:

  - Spring to version 5.3.23
  - Spring Boot to version 2.7.6
  - Spring Security to version 5.7.5
  - Tomcat to version 9.0.71
  - GraphQL to version 20.0
  - Groovy to version 3.0.14
  - Jackson (and related) to version 2.14.2
  - JGit to version 6.4.0.202211300538-r
  - Apache CXF to version 3.4.10
  - Google protobuf to version 3.19.6
  - The embedded MariaDB library to version 2.6.0
  - Apache Commons Text to version 1.10.0
  - Various Studio UI libraries

* Added support for editing text files|br|
  See `here <https://github.com/craftercms/craftercms/issues/5939>`__ for more information

* Fixed issue with *Video Transcode* form control |br|
  See `here <https://github.com/craftercms/craftercms/issues/5935>`__ for more information

* Fixed issue with the disabled bit not updating properly when content changes through git |br|
  See `here <https://github.com/craftercms/craftercms/issues/5960>`__ for more information

* Fixed issue with XB targets not honoring multiple "Components" data sources |br|
  See `here <https://github.com/craftercms/craftercms/issues/5940>`__ for more information

* Fixed issue with Javascript SDK's ``ContentInstance`` interface not exposing the
  ``orderDefault_f`` field used by pages |br|
  See `here <https://github.com/craftercms/craftercms/issues/5871>`__ for more information

* Fixed issue with extracted ``internal-name`` field on save when embedded content data source is used |br|
  See `here <https://github.com/craftercms/craftercms/issues/5905>`__ for more information

* Fixed issue when pasting from a Word document with a link in the RTE  |br|
  See `here <https://github.com/craftercms/craftercms/issues/5971>`__ for more information

* Fixed issue with form not saving when form contains a repeat group that contains a checkbox field
  with a default value set to false   |br|
  See `here <https://github.com/craftercms/craftercms/issues/5975>`__ for more information

* Fixed issue with LDAP authentication while creating group

* Fixed issue with ``Publish All`` failing when blob is missing  |br|
  See `here <https://github.com/craftercms/craftercms/issues/5949>`__ for more information

Lots of other small enhancements and bug fixes :)

For a full list of tickets, please visit: `GitHub 4.0.3 Milestone <https://github.com/craftercms/craftercms/milestone/91?closed=1>`_

For information on upgrading 3.1.x sites, see :ref:`here <compatibility-with-3.1.x>`

.. important::

    Please see :ref:`Breaking Changes <breaking-changes-4-0-x>` for breaking changes and other
    things to consider before upgrading

    For instructions on how to update your CrafterCMS install to 4.0.0 (applies to 4.0.2),
    please see :ref:`upgrading-craftercms`

    When using private key SSH authentication in the ``init-site.sh`` script, the private key path must be set explicitly. |br|
    Please see :ref:`setup-project-for-delivery` for more information on using the ``-k`` option of ``init-site.sh`` to
    set the private key path

    For Linux installs, the Studio upgrade requires the library ``libaio`` which is not installed
    by default in some Linux distributions.  Please see the section on **Linux Prerequisites**
    in :ref:`prerequisites` for instructions on how to install the library ``libaio``

|
|

.. raw:: html

   <hr>

